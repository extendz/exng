<mat-toolbar> <button mat-button color="primary" (click)="addRow()">Add Row</button></mat-toolbar>
<form [formGroup]="formGroup">
  <mat-table
    [dataSource]="dataSource"
    formArrayName="data"
    class="mat-elevation-z2"
    fixedLayout="true"
  >
    <ng-container
      *ngFor="let p of property.entityMeta.properties | keyvalue"
      [matColumnDef]="p.key"
    >
      <mat-header-cell *matHeaderCellDef [fxFlex.lg]="p?.value.width?.lg">
        {{ p.key | camelCase }}
      </mat-header-cell>

      <mat-cell
        *matCellDef="let e; let i = index"
        [formGroupName]="i"
        [fxFlex.lg]="p?.value?.width?.lg"
      >
        <span [ngSwitch]="p?.value?.type">
          <!-- number -->
          <mat-form-field
            *ngSwitchCase="'number'"
            [fxFlex.lg]="p?.value.width?.lg || 80"
            floatLabel="never"
            appearance="outline"
          >
            <input type="number" matInput autocomplete="off" [formControlName]="p?.value?.name" />
          </mat-form-field>

          <!-- Sting -->
          <mat-form-field
            *ngSwitchCase="'string'"
            floatLabel="never"
            appearance="outline"
            [fxFlex.lg]="p?.value.width?.lg || 80"
          >
            <input type="text" matInput autocomplete="off" [formControlName]="p?.value?.name" />
            <mat-error *ngIf="formGroup.controls[property.name].hasError('required')">
              {{ property.name | camelCase }} is
              <strong>required</strong>
            </mat-error>
          </mat-form-field>

          <!-- enum -->
          <mat-form-field
            *ngSwitchCase="'enum'"
            floatLabel="never"
            appearance="outline"
            [fxFlex.lg]="p?.value.width?.lg || 80"
          >
            <mat-select [formControlName]="p.value.name">
              <mat-option *ngFor="let enum of p.value.enums" [value]="enum">
                {{ enum }}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <!-- object -->
          <ext-select
            *ngSwitchCase="'object'"
            [property]="p.value"
            [formControlName]="p.value.name"
          >
          </ext-select>
        </span>
      </mat-cell>
    </ng-container>

    <ng-container matColumnDef="save">
      <mat-header-cell *matHeaderCellDef fxFlex="48px"> Save </mat-header-cell>
      <mat-cell *matCellDef="let row" fxFlex="48px">
        <button mat-icon-button (click)="save(row)">
          <mat-icon>
            <svg id="save" viewBox="0 0 24 24" class="primary-text">
              <path d="M0 0h24v24H0z" fill="none" />
              <path
                d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"
              />
            </svg>
          </mat-icon>
        </button>
      </mat-cell>
    </ng-container>

    <mat-header-row *matHeaderRowDef="allColumns"></mat-header-row>
    <mat-row *matRowDef="let row; columns: allColumns"></mat-row>
  </mat-table>
</form>
