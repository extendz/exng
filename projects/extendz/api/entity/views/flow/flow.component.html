<div class="form-wrapper">
  <div class="bottom-right" *ngIf="loading">
    <mat-spinner diameter="30"></mat-spinner>
  </div>
  <!-- {{ formGroup.value | json }} -->
  <form [formGroup]="formGroup" fxLayout="row wrap" fxLayoutAlign="space-between center">
    <span
      *ngFor="let property of properties"
      [fxFlex.lg]="property?.width?.lg || 24"
      [fxFlex.xs]="property?.width?.xs || 100"
      style="height: 8vh"
    >
      <!-- String -->
      <mat-form-field *ngIf="property.type == propertyTypes.string">
        <input
          autocomplete="off"
          matInput
          [id]="property.name"
          [placeholder]="property.name | camelCase"
          [formControlName]="property.name"
        />
        <mat-error *ngIf="formGroup.controls[property.name].hasError('required')">
          {{ property.name | camelCase }} is
          <strong>required</strong>
        </mat-error>
      </mat-form-field>

      <!-- Enums -->
      <mat-form-field *ngIf="property.type == propertyTypes.enum">
        <mat-select [placeholder]="property.name | camelCase" [formControlName]="property.name">
          <mat-option *ngFor="let enum of property.enums" [value]="enum">
            {{ enum }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <!-- Number -->
      <mat-form-field *ngIf="property.type == propertyTypes.number">
        <input
          autocomplete="off"
          matInput
          type="number"
          [placeholder]="property.name | camelCase"
          [formControlName]="property.name"
        />
        <mat-error *ngIf="formGroup.controls[property.name].hasError('required')">
          {{ property.name | camelCase }}
          <strong>required</strong>
        </mat-error>
      </mat-form-field>

      <!-- Date -->
      <mat-form-field *ngIf="property.type == propertyTypes.date">
        <input
          matInput
          autocomplete="off"
          [matDatepicker]="picker"
          [placeholder]="property.name | camelCase"
          [formControlName]="property.name"
        />
        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-datepicker [touchUi]="media.isActive('xs')" #picker></mat-datepicker>
        <mat-error *ngIf="formGroup.controls[property.name].hasError('required')">
          {{ property.name | camelCase }}
          <strong>required</strong>
        </mat-error>
      </mat-form-field>

      <!-- Object -->
      <ext-select
        *ngIf="property.type == propertyTypes.object"
        [property]="property"
        [formControlName]="property.name"
      >
      </ext-select>

      <!-- Embebed -->
      <ext-embedded
        *ngIf="property.type == propertyTypes.embedded"
        [property]="property"
        [(entity)]="entity"
        [formControlName]="property.name"
      >
      </ext-embedded>

      <!-- Money -->
      <mat-form-field *ngIf="property.type == propertyTypes.money">
        <ext-money
          [property]="property"
          [placeholder]="property.name | camelCase"
          [formControlName]="property.name"
        >
        </ext-money>
        <mat-error *ngIf="formGroup.controls[property.name].hasError('required')">
          {{ property.name | camelCase }} is <strong>required!</strong>
        </mat-error>
      </mat-form-field>

      <!-- Tab -->
      <mat-tab-group *ngIf="property.type == propertyTypes.tabs">
        <mat-tab color="primary" *ngFor="let tab of property.tabs">
          <ng-template mat-tab-label>
            <mat-icon class="tab-icon" svgIcon="api-root:{{ tab?.reference }}"></mat-icon>
            <b>{{ tab.displayName }}</b>
          </ng-template>

          <ng-template matTabContent>
            <ext-input-table [property]="tab" [formControlName]="tab.name"></ext-input-table>
          </ng-template>
        </mat-tab>
      </mat-tab-group>
    </span>

    <ng-container *ngTemplateOutlet="saveButton"></ng-container>
  </form>
  <div style="height: 64px"></div>
</div>

<ng-template #saveButton>
  <button
    mat-fab
    id="btnSave"
    matTooltip="Save"
    type="submit"
    [disabled]="loading"
    class="bottom-right"
    (click)="onSave(true)"
  >
    <mat-icon>
      <svg id="save" viewBox="0 0 24 24" class="primary-text">
        <path d="M0 0h24v24H0z" fill="none" />
        <path
          d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"
        />
      </svg>
    </mat-icon>
  </button>
  <mat-spinner diameter="60" class="bottom-right" *ngIf="loading"></mat-spinner>
</ng-template>
